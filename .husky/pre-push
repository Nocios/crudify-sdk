#!/usr/bin/env sh

# Cargar variables de entorno (archivo simple, sin comandos)
. ~/.zshenv 2>/dev/null

echo "Running pre-push checks (comprehensive)..."

# 1. TypeCheck
echo "\n[1/5] Type checking..."
pnpm run typecheck || exit 1

# 2. Lint
echo "\n[2/5] Linting..."
pnpm run lint || exit 1

# 3. Tests con coverage
echo "\n[3/5] Running tests..."
pnpm run test:coverage || exit 1

# 4. Build (valida que el bundle se genera)
echo "\n[4/5] Building..."
pnpm run build || exit 1

echo "\n‚úÖ All critical checks passed!"

# 5. Sonar (no bloqueante - si falla, el push continua)
echo "\n[5/5] Running sonar analysis (non-blocking)..."
pnpm run sonar || echo "‚ö†Ô∏è  Sonar analysis failed, but push will continue"

echo "\nüöÄ Ready to push!"
